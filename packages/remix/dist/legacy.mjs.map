{"version":3,"sources":["../src/legacy/routerProvider.ts","../src/legacy/prompt.tsx","../src/legacy/useParams.ts","../src/legacy/checkAuthentication.ts","../src/legacy/routeComponent.tsx","../src/legacy/index.ts"],"sourcesContent":["import { IRouterProvider } from \"@refinedev/core\";\nimport { Link, useLocation, useNavigate } from \"@remix-run/react\";\n\nimport { Prompt } from \"./prompt\";\nimport { useParams } from \"./useParams\";\n\nexport const RouterProvider: IRouterProvider = {\n  useHistory: () => {\n    const navigate = useNavigate();\n\n    return {\n      push: navigate,\n      replace: (path: string) => {\n        navigate(path, { replace: true });\n      },\n      goBack: () => {\n        navigate(-1);\n      },\n    };\n  },\n  useLocation: () => {\n    const location = useLocation();\n\n    return location;\n  },\n  useParams,\n  Prompt,\n  Link,\n};\n","import React from \"react\";\nimport { useBlocker } from \"@remix-run/react\";\n\nimport type { PromptProps } from \"@refinedev/core\";\n\nexport const Prompt: React.FC<PromptProps> = ({\n  message,\n  when,\n  setWarnWhen,\n}) => {\n  const blocker = React.useCallback(() => {\n    if (when) {\n      if (window.confirm(message)) {\n        setWarnWhen?.(false);\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }, [when, message, setWarnWhen]);\n\n  useBlocker(blocker);\n\n  return null;\n};\n","import {\n  handleUseParams,\n  IRouterProvider,\n  ResourceRouterParams,\n  RouteAction,\n} from \"@refinedev/core\";\nimport { useParams as useRemixParams } from \"@remix-run/react\";\n\nconst actions: RouteAction[] = [\"clone\", \"create\", \"edit\", \"show\"];\n\nexport const isAction = (param: string): boolean => {\n  return actions.includes(param as RouteAction);\n};\n\nexport const lastActionIndex = (params: string[]): number => {\n  const reversedFirstIndex = params.slice().reverse().findIndex(isAction);\n\n  if (reversedFirstIndex === -1) {\n    return -1;\n  }\n\n  return params.length - reversedFirstIndex - 1;\n};\n\nexport const composeParams = (params: string[]): ResourceRouterParams => {\n  const actionIndex = lastActionIndex(params);\n\n  if (actionIndex !== -1 && actionIndex !== 0) {\n    const resource = params.slice(0, actionIndex).join(\"/\");\n    const action = params[actionIndex];\n    const id = params[actionIndex + 1];\n\n    return {\n      resource,\n      action: action as RouteAction,\n      id,\n    };\n  }\n\n  const resource = params.join(\"/\");\n\n  return {\n    resource,\n    action: undefined,\n  };\n};\n\nexport const handleRefineParams = (\n  refineSplat?: string,\n): ResourceRouterParams | Record<string, string> => {\n  if (refineSplat) {\n    const params = refineSplat.split(\"/\").filter(Boolean);\n    return composeParams(params);\n  }\n  return {};\n};\n\nexport const useParams: IRouterProvider[\"useParams\"] = () => {\n  const params = useRemixParams();\n\n  return handleUseParams({\n    ...handleRefineParams(params[\"*\"]),\n    ...params,\n  });\n};\n","import { LegacyAuthProvider } from \"@refinedev/core\";\nimport { redirect } from \"@remix-run/node\";\n\nexport const checkAuthentication = async (\n  authProvider: LegacyAuthProvider,\n  request: Request,\n  redirectTo: string = new URL(request.url).pathname,\n): Promise<any> => {\n  try {\n    const user = await authProvider.checkAuth?.({ request });\n    return user;\n  } catch (error) {\n    if (redirectTo !== \"/login\") {\n      const { pathname } = new URL(request.url);\n      if (pathname === \"/\") {\n        throw redirect(\"/login\");\n      }\n      const searchParams = new URLSearchParams([[\"to\", redirectTo]]);\n      throw redirect(`/login?${searchParams}`);\n    }\n  }\n};\n","import React, { PropsWithChildren, useEffect } from \"react\";\nimport { useLoaderData } from \"@remix-run/react\";\n\nimport {\n  useRefineContext,\n  LayoutWrapper,\n  ErrorComponent,\n  useResource,\n  LoginPage as DefaultLoginPage,\n  CanAccess,\n} from \"@refinedev/core\";\nimport type { ResourceRouterParams } from \"@refinedev/core\";\n\nimport { RouterProvider } from \"./routerProvider\";\nconst { useHistory, useLocation, useParams } = RouterProvider;\n\ntype RemixRouteComponentProps = {\n  initialData?: any;\n};\n\nexport function RemixRouteComponent(\n  this: { initialRoute?: string },\n  { children: _children, ...rest }: PropsWithChildren<RemixRouteComponentProps>,\n): React.ReactNode {\n  const loaderData = useLoaderData<any>();\n  const { resources } = useResource();\n  const { push } = useHistory();\n  const {\n    resource: routeResourceName,\n    action,\n    id,\n  } = useParams<ResourceRouterParams>();\n\n  const { pathname } = useLocation();\n\n  const { DashboardPage, catchAll, LoginPage } = useRefineContext();\n\n  const resource = resources.find(\n    (res) => res.name === routeResourceName || res.route === routeResourceName,\n  );\n\n  useEffect(() => {\n    if (pathname === \"/\" && !DashboardPage) {\n      if (typeof this !== \"undefined\" && this.initialRoute) {\n        push(\n          this.initialRoute.startsWith(\"/\")\n            ? this.initialRoute\n            : `/${this.initialRoute}`,\n        );\n      } else {\n        // push(`/${resources.find((p) => p.list)?.route}`);\n\n        /*\n         * the above line is a better solution for the initial route\n         * but in Remix, users can have custom pages through file system\n         * which makes `list` component of the resource redundant.\n         * for these cases, we need to redirect to the first resource\n         * in the resources array, no matter if it has a list component or not.\n         */\n\n        push(`/${resources[0].route?.replace(/^\\//, \"\")}`);\n      }\n    }\n  }, [pathname]);\n\n  const renderLoginRouteElement = (): JSX.Element => {\n    if (LoginPage) return <LoginPage />;\n    return <DefaultLoginPage />;\n  };\n\n  if (routeResourceName === \"login\") {\n    return renderLoginRouteElement();\n  }\n\n  if (pathname === \"/\") {\n    if (DashboardPage) {\n      return (\n        <LayoutWrapper>\n          <CanAccess\n            resource=\"dashboard\"\n            action=\"list\"\n            fallback={catchAll ?? <ErrorComponent />}\n          >\n            <DashboardPage />\n          </CanAccess>\n        </LayoutWrapper>\n      );\n    }\n    return null;\n  }\n\n  if (resource) {\n    const {\n      list,\n      create,\n      edit,\n      show,\n      name,\n      canCreate,\n      canEdit,\n      canShow,\n      canDelete,\n      options,\n    } = resource;\n\n    const stringError = () =>\n      console.error(\n        \"`string` resource routes are not supported in legacy router. Please switch to the new router or assign Components to the resource routes.\",\n      );\n    const definitionError = () =>\n      console.error(\n        \"`Object` resource routes are not supported in legacy router. Please switch to the new router or assign Components to the resource routes.\",\n      );\n\n    const List =\n      (typeof list === \"string\"\n        ? stringError()\n        : typeof list === \"object\"\n          ? definitionError()\n          : list) ?? (() => null);\n    const Create =\n      (typeof create === \"string\"\n        ? stringError()\n        : typeof create === \"object\"\n          ? definitionError()\n          : create) ?? (() => null);\n    const Edit =\n      (typeof edit === \"string\"\n        ? stringError()\n        : typeof edit === \"object\"\n          ? definitionError()\n          : edit) ?? (() => null);\n    const Show =\n      (typeof show === \"string\"\n        ? stringError()\n        : typeof show === \"object\"\n          ? definitionError()\n          : show) ?? (() => null);\n\n    const renderCrud = () => {\n      switch (action) {\n        case undefined: {\n          return (\n            <CanAccess\n              resource={name}\n              action=\"list\"\n              fallback={catchAll ?? <ErrorComponent />}\n            >\n              <List\n                name={name}\n                canCreate={canCreate}\n                canEdit={canEdit}\n                canDelete={canDelete}\n                canShow={canShow}\n                initialData={loaderData?.initialData}\n                options={options}\n                {...rest}\n              />\n            </CanAccess>\n          );\n        }\n\n        case \"create\":\n        case \"clone\": {\n          return (\n            <CanAccess\n              resource={name}\n              action=\"create\"\n              fallback={catchAll ?? <ErrorComponent />}\n            >\n              <Create\n                name={name}\n                canCreate={canCreate}\n                canEdit={canEdit}\n                canDelete={canDelete}\n                canShow={canShow}\n                initialData={loaderData?.initialData}\n                options={options}\n                {...rest}\n              />\n            </CanAccess>\n          );\n        }\n\n        case \"edit\": {\n          return (\n            <CanAccess\n              resource={name}\n              action=\"edit\"\n              params={{ id }}\n              fallback={catchAll ?? <ErrorComponent />}\n            >\n              <Edit\n                name={name}\n                canCreate={canCreate}\n                canEdit={canEdit}\n                canDelete={canDelete}\n                canShow={canShow}\n                initialData={loaderData?.initialData}\n                options={options}\n                {...rest}\n              />\n            </CanAccess>\n          );\n        }\n\n        case \"show\": {\n          return (\n            <CanAccess\n              resource={name}\n              action=\"show\"\n              params={{ id }}\n              fallback={catchAll ?? <ErrorComponent />}\n            >\n              <Show\n                name={name}\n                canCreate={canCreate}\n                canEdit={canEdit}\n                canDelete={canDelete}\n                canShow={canShow}\n                initialData={loaderData?.initialData}\n                options={options}\n                {...rest}\n              />\n            </CanAccess>\n          );\n        }\n      }\n    };\n\n    return <LayoutWrapper>{renderCrud()}</LayoutWrapper>;\n  }\n  return catchAll ? (\n    <>{catchAll}</>\n  ) : (\n    <LayoutWrapper>\n      <ErrorComponent />\n    </LayoutWrapper>\n  );\n}\n","import { RouterProvider } from \"./routerProvider\";\n\nexport { checkAuthentication } from \"./checkAuthentication\";\nexport { RemixRouteComponent } from \"./routeComponent\";\nexport { handleRefineParams } from \"./useParams\";\nexport default RouterProvider;\n"],"mappings":"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","names":["resource","React","useLocation","useParams","React"]}